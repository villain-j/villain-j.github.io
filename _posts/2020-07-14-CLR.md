---
title: "CLR의 실행 모델"
categories:
  - csharp
author_profile: true
read_time: true

classes: wide
toc: false

---



1. **Compiling Source Code into Managed Module**

   CLR: Common Language Runtime, 공용 언어 런타임

   CLR은 메모리 관리, 어셈블리 로딩, 보안, 예외처리, 쓰레드 동기화 등등을 관리한다.

   서로 다른 언어들이 사용할 수 있는 런타임 환경을 가리킨다. 각각의 언어를 CLR을 타깃으로 하는 컴파일러로 컴파일하면 managed module(PE32/PE32+)이 된다.

   Managed module에는

   - PE32/PE32+ header: file type(dll, gui, cui...)
   - CLR header: CLR 모듈이 되게 만드는 정보를 가짐
   - metadata: types, members, etc
   - IL code: 컴파일러가 생성한 코드. 실행될 때 native CPU 명령어로 변환되어 실행된다.

   등의 내용이 있다.

   

2. **Combining Managed Module to Assemblies**

   Assembly: .NET 기반 어플리케이션에서의 기본 단위: 재사용, 보안, 버젼 제어 등에서의 기본 단위이다.

   1개 혹은 그 이상의 리소스 파일이 조합된 결과이다. "manifest"라는 metadata table을 가진다.

   .dll, .exe 파일 등의 형태로 존재한다.

   

3. **Loading the CLR**

   .NET 설치 필요

   Platform switch: 결과 모듈 설정 가능(CPU, 32/64 bit)

   

4. **Executing Your Assembly's Code**

   IL: CPU에 독립적인 기계어. 객체지향적인 기계어.

   메서드가 처음 불리면 JIT(Just In Time) 컴파일러가 해당 IL 코드를 native CPU instruction으로 변환하고, 이를 동적 메모리에 저장한다. (어플리케이션이 종료되면 날라감) 그 다음에 또 실행되면 바로 dynamic memory에 저장된 부분으로 이동해서 실행된다.

   생각보다 IL 코드 변환 / 동적 메모리 오버헤드로 인한 성능 저하가 크지 않고, 로컬 플랫폼에 최적화되게 코드를 생성하기 때문에 효율적이다.

   

5. **IL & Verification**

   IL은 스택을 기반으로 하고 타입이 정해져있지 않다. 이 때문에 verification을 통해 코드의 안전성을 테스트하고, verification이 보안을 보장한다. 이 때문에 같은 주소 공간에 여러 프로세스를 돌려도 안전하다.

   verification을 사용하지 않는 코드도 사용할 수는 있지만 위험하므로 시스템이 허용할 경우에만 실행 가능하다.

   

6. **The Native Code Generator Tool : NGen.exe**

   어플리케이션이 설치될 때 native code로 컴파일하게 하는 툴이다. 이를 통해 프로그램을 시작할 때 걸리는 시간이 감소하고, 여러 프로그램에서 공유할 수 있기 때문에 메모리 사용량이 감소한다. 그러나 코드가 유출될 가능성이 있고, 현재 로컬 환경과 설치될 때의 환경이 달라 생길 수 있는 문제, 실행 시간이 증가하는 문제 또한 안고 있다.

   

7. **The Framework Class Library(FCL)**

   .NET 프레임워크에서 시스템 기능을 사용할 수 있도록 제공하는 라이브러리.

   유틸리티 기능, 운영체제 기능 wrapper, 프레임워크를 위한 FCL들이 존재한다.

   System, System.Collections, System.IO, System,Linq 등등 없어서는 안 될 소중한 라이브러리들!

   

8. **Common Type System(CTS)**

   CLR에서 다른 언어로 쓰인 코드와 상호작용할 수 있도록 공통적인 Type을 정의하고 사용 방법을 설명하기 위한 공식 규약이다.

   Type의 종류에는 Class, Structure, Enum, Interface, Delegate가 있다.

   

9. **Common Language Specification(CLS)**

   여러 언어가 공통적으로 가지고 있어 사용할 수 있는 부분을 정의한다. CTS의 부분 집합으로, CTS에서의 규칙은 모두 CLS에 적용된다.

   

10. **Interoperability with Unmanaged Code**

    Managed 환경에서는 dll 파일 안의 unmanaged 코드를 호출할 수 있다.

    Managed 환경에서는 COM component를 호출할 수 있다.

    Unmanaged 환경에서도 managed type을 사용할 수 있다.